\hypertarget{system_2linux_2irq_8c}{}\section{lib/system/linux/irq.c File Reference}
\label{system_2linux_2irq_8c}\index{lib/system/linux/irq.\+c@{lib/system/linux/irq.\+c}}


Linux libmetal irq operations.  


{\ttfamily \#include $<$pthread.\+h$>$}\newline
{\ttfamily \#include $<$sched.\+h$>$}\newline
{\ttfamily \#include $<$metal/device.\+h$>$}\newline
{\ttfamily \#include $<$metal/irq.\+h$>$}\newline
{\ttfamily \#include $<$metal/irq\+\_\+controller.\+h$>$}\newline
{\ttfamily \#include $<$metal/sys.\+h$>$}\newline
{\ttfamily \#include $<$metal/mutex.\+h$>$}\newline
{\ttfamily \#include $<$metal/list.\+h$>$}\newline
{\ttfamily \#include $<$metal/utilities.\+h$>$}\newline
{\ttfamily \#include $<$metal/alloc.\+h$>$}\newline
{\ttfamily \#include $<$sys/time.\+h$>$}\newline
{\ttfamily \#include $<$sys/eventfd.\+h$>$}\newline
{\ttfamily \#include $<$stdbool.\+h$>$}\newline
{\ttfamily \#include $<$stdint.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$poll.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}{M\+A\+X\+\_\+\+I\+R\+QS}~(F\+D\+\_\+\+S\+E\+T\+S\+I\+ZE -\/ 1)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{system_2linux_2irq_8c_a33a25762ff717edfd5822dc8986b2233}{metal\+\_\+linux\+\_\+irq\+\_\+set\+\_\+enable} (struct \hyperlink{structmetal__irq__controller}{metal\+\_\+irq\+\_\+controller} $\ast$irq\+\_\+cntr, int irq, unsigned int state)
\item 
static \hyperlink{system_2linux_2irq_8c_a133283412c646c8d4d9333914cd04916}{M\+E\+T\+A\+L\+\_\+\+I\+R\+Q\+\_\+\+C\+O\+N\+T\+R\+O\+L\+L\+E\+R\+\_\+\+D\+E\+C\+L\+A\+RE} (linux\+\_\+irq\+\_\+cntr, 0, \hyperlink{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}{M\+A\+X\+\_\+\+I\+R\+QS}, N\+U\+LL, \hyperlink{system_2linux_2irq_8c_a33a25762ff717edfd5822dc8986b2233}{metal\+\_\+linux\+\_\+irq\+\_\+set\+\_\+enable}, N\+U\+LL, \hyperlink{system_2linux_2irq_8c_a593c726328bb9676820ce17af79d095b}{irqs})
\item 
unsigned int \hyperlink{group__irq_ga79cd09db2f2ef9dd4c05117861f47066}{metal\+\_\+irq\+\_\+save\+\_\+disable} (void)
\begin{DoxyCompactList}\small\item\em disable interrupts \end{DoxyCompactList}\item 
void \hyperlink{group__irq_gaf39101252fba3dcefac3dd0f7919945f}{metal\+\_\+irq\+\_\+restore\+\_\+enable} (unsigned int flags)
\begin{DoxyCompactList}\small\item\em restore interrupts to their previous state \end{DoxyCompactList}\item 
static int \hyperlink{system_2linux_2irq_8c_affd3055534ce2e2c5e987c161fc8a73b}{metal\+\_\+linux\+\_\+irq\+\_\+notify} (void)
\item 
static void $\ast$ \hyperlink{system_2linux_2irq_8c_abac5c808fcbf8c7d5d21dae13f73cfe6}{metal\+\_\+linux\+\_\+irq\+\_\+handling} (void $\ast$args)
\begin{DoxyCompactList}\small\item\em I\+RQ handler. \end{DoxyCompactList}\item 
int \hyperlink{system_2linux_2irq_8c_a80efc9a82781b2d469287aa2e85694ff}{metal\+\_\+linux\+\_\+irq\+\_\+init} (void)
\begin{DoxyCompactList}\small\item\em irq handling initialization \end{DoxyCompactList}\item 
void \hyperlink{system_2linux_2irq_8c_ad6bad8e0caf18090c74d135037734500}{metal\+\_\+linux\+\_\+irq\+\_\+shutdown} (void)
\begin{DoxyCompactList}\small\item\em irq handling shutdown \end{DoxyCompactList}\item 
void \hyperlink{system_2linux_2irq_8c_a467cf1ded411f243e92ee45e18442088}{metal\+\_\+linux\+\_\+irq\+\_\+register\+\_\+dev} (struct \hyperlink{structmetal__device}{metal\+\_\+device} $\ast$dev, int irq)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static struct \hyperlink{structmetal__device}{metal\+\_\+device} $\ast$ \hyperlink{system_2linux_2irq_8c_a93e518beb51d999eb70289c87dee2cff}{irqs\+\_\+devs} \mbox{[}\hyperlink{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}{M\+A\+X\+\_\+\+I\+R\+QS}\mbox{]}
\item 
static int \hyperlink{system_2linux_2irq_8c_a89821fe6b579aed2ce111200cb872741}{irq\+\_\+notify\+\_\+fd}
\item 
static \hyperlink{structmetal__mutex__t}{metal\+\_\+mutex\+\_\+t} \hyperlink{system_2linux_2irq_8c_a3d8ff4a6ac19d021cfacbe49c9e84638}{irq\+\_\+lock}
\item 
static bool \hyperlink{system_2linux_2irq_8c_a29becacd515e4e3ae71e2397ee2e5ae8}{irq\+\_\+handling\+\_\+stop}
\item 
static pthread\+\_\+t \hyperlink{system_2linux_2irq_8c_a0cb68880a956c332edc5d7db941c40f1}{irq\+\_\+pthread}
\item 
static unsigned long \hyperlink{system_2linux_2irq_8c_a0663568d605d4d92a0a4e2cd7ac27679}{irqs\+\_\+enabled} \mbox{[}\hyperlink{group__utilities_gace231318276c47f6e2fbc12e61fd5b7c}{metal\+\_\+div\+\_\+round\+\_\+up}(\hyperlink{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}{M\+A\+X\+\_\+\+I\+R\+QS}, \hyperlink{group__utilities_ga346994d9555206ff5b417774f1b1a81c}{M\+E\+T\+A\+L\+\_\+\+B\+I\+T\+S\+\_\+\+P\+E\+R\+\_\+\+U\+L\+O\+NG})\mbox{]}
\item 
static struct \hyperlink{structmetal__irq}{metal\+\_\+irq} \hyperlink{system_2linux_2irq_8c_a593c726328bb9676820ce17af79d095b}{irqs} \mbox{[}\hyperlink{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}{M\+A\+X\+\_\+\+I\+R\+QS}\mbox{]}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Linux libmetal irq operations. 



\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}\label{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!M\+A\+X\+\_\+\+I\+R\+QS@{M\+A\+X\+\_\+\+I\+R\+QS}}
\index{M\+A\+X\+\_\+\+I\+R\+QS@{M\+A\+X\+\_\+\+I\+R\+QS}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{M\+A\+X\+\_\+\+I\+R\+QS}{MAX\_IRQS}}
{\footnotesize\ttfamily \#define M\+A\+X\+\_\+\+I\+R\+QS~(F\+D\+\_\+\+S\+E\+T\+S\+I\+ZE -\/ 1)}

maximum number of irqs 

\subsection{Function Documentation}
\mbox{\Hypertarget{system_2linux_2irq_8c_a133283412c646c8d4d9333914cd04916}\label{system_2linux_2irq_8c_a133283412c646c8d4d9333914cd04916}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!M\+E\+T\+A\+L\+\_\+\+I\+R\+Q\+\_\+\+C\+O\+N\+T\+R\+O\+L\+L\+E\+R\+\_\+\+D\+E\+C\+L\+A\+RE@{M\+E\+T\+A\+L\+\_\+\+I\+R\+Q\+\_\+\+C\+O\+N\+T\+R\+O\+L\+L\+E\+R\+\_\+\+D\+E\+C\+L\+A\+RE}}
\index{M\+E\+T\+A\+L\+\_\+\+I\+R\+Q\+\_\+\+C\+O\+N\+T\+R\+O\+L\+L\+E\+R\+\_\+\+D\+E\+C\+L\+A\+RE@{M\+E\+T\+A\+L\+\_\+\+I\+R\+Q\+\_\+\+C\+O\+N\+T\+R\+O\+L\+L\+E\+R\+\_\+\+D\+E\+C\+L\+A\+RE}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{M\+E\+T\+A\+L\+\_\+\+I\+R\+Q\+\_\+\+C\+O\+N\+T\+R\+O\+L\+L\+E\+R\+\_\+\+D\+E\+C\+L\+A\+R\+E()}{METAL\_IRQ\_CONTROLLER\_DECLARE()}}
{\footnotesize\ttfamily static M\+E\+T\+A\+L\+\_\+\+I\+R\+Q\+\_\+\+C\+O\+N\+T\+R\+O\+L\+L\+E\+R\+\_\+\+D\+E\+C\+L\+A\+RE (\begin{DoxyParamCaption}\item[{linux\+\_\+irq\+\_\+cntr}]{,  }\item[{0}]{,  }\item[{\hyperlink{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}{M\+A\+X\+\_\+\+I\+R\+QS}}]{,  }\item[{N\+U\+LL}]{,  }\item[{\hyperlink{system_2linux_2irq_8c_a33a25762ff717edfd5822dc8986b2233}{metal\+\_\+linux\+\_\+irq\+\_\+set\+\_\+enable}}]{,  }\item[{N\+U\+LL}]{,  }\item[{\hyperlink{system_2linux_2irq_8c_a593c726328bb9676820ce17af79d095b}{irqs}}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{system_2linux_2irq_8c_abac5c808fcbf8c7d5d21dae13f73cfe6}\label{system_2linux_2irq_8c_abac5c808fcbf8c7d5d21dae13f73cfe6}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!metal\+\_\+linux\+\_\+irq\+\_\+handling@{metal\+\_\+linux\+\_\+irq\+\_\+handling}}
\index{metal\+\_\+linux\+\_\+irq\+\_\+handling@{metal\+\_\+linux\+\_\+irq\+\_\+handling}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+linux\+\_\+irq\+\_\+handling()}{metal\_linux\_irq\_handling()}}
{\footnotesize\ttfamily static void$\ast$ metal\+\_\+linux\+\_\+irq\+\_\+handling (\begin{DoxyParamCaption}\item[{void $\ast$}]{args }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



I\+RQ handler. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em args} & not used. required for pthread. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{system_2linux_2irq_8c_a80efc9a82781b2d469287aa2e85694ff}\label{system_2linux_2irq_8c_a80efc9a82781b2d469287aa2e85694ff}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!metal\+\_\+linux\+\_\+irq\+\_\+init@{metal\+\_\+linux\+\_\+irq\+\_\+init}}
\index{metal\+\_\+linux\+\_\+irq\+\_\+init@{metal\+\_\+linux\+\_\+irq\+\_\+init}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+linux\+\_\+irq\+\_\+init()}{metal\_linux\_irq\_init()}}
{\footnotesize\ttfamily int metal\+\_\+linux\+\_\+irq\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



irq handling initialization 

\begin{DoxyReturn}{Returns}
0 on success, non-\/zero on failure 
\end{DoxyReturn}
\mbox{\Hypertarget{system_2linux_2irq_8c_affd3055534ce2e2c5e987c161fc8a73b}\label{system_2linux_2irq_8c_affd3055534ce2e2c5e987c161fc8a73b}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!metal\+\_\+linux\+\_\+irq\+\_\+notify@{metal\+\_\+linux\+\_\+irq\+\_\+notify}}
\index{metal\+\_\+linux\+\_\+irq\+\_\+notify@{metal\+\_\+linux\+\_\+irq\+\_\+notify}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+linux\+\_\+irq\+\_\+notify()}{metal\_linux\_irq\_notify()}}
{\footnotesize\ttfamily static int metal\+\_\+linux\+\_\+irq\+\_\+notify (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{system_2linux_2irq_8c_a467cf1ded411f243e92ee45e18442088}\label{system_2linux_2irq_8c_a467cf1ded411f243e92ee45e18442088}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!metal\+\_\+linux\+\_\+irq\+\_\+register\+\_\+dev@{metal\+\_\+linux\+\_\+irq\+\_\+register\+\_\+dev}}
\index{metal\+\_\+linux\+\_\+irq\+\_\+register\+\_\+dev@{metal\+\_\+linux\+\_\+irq\+\_\+register\+\_\+dev}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+linux\+\_\+irq\+\_\+register\+\_\+dev()}{metal\_linux\_irq\_register\_dev()}}
{\footnotesize\ttfamily void metal\+\_\+linux\+\_\+irq\+\_\+register\+\_\+dev (\begin{DoxyParamCaption}\item[{struct \hyperlink{structmetal__device}{metal\+\_\+device} $\ast$}]{dev,  }\item[{int}]{irq }\end{DoxyParamCaption})}

\mbox{\Hypertarget{system_2linux_2irq_8c_a33a25762ff717edfd5822dc8986b2233}\label{system_2linux_2irq_8c_a33a25762ff717edfd5822dc8986b2233}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!metal\+\_\+linux\+\_\+irq\+\_\+set\+\_\+enable@{metal\+\_\+linux\+\_\+irq\+\_\+set\+\_\+enable}}
\index{metal\+\_\+linux\+\_\+irq\+\_\+set\+\_\+enable@{metal\+\_\+linux\+\_\+irq\+\_\+set\+\_\+enable}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+linux\+\_\+irq\+\_\+set\+\_\+enable()}{metal\_linux\_irq\_set\_enable()}}
{\footnotesize\ttfamily static void metal\+\_\+linux\+\_\+irq\+\_\+set\+\_\+enable (\begin{DoxyParamCaption}\item[{struct \hyperlink{structmetal__irq__controller}{metal\+\_\+irq\+\_\+controller} $\ast$}]{irq\+\_\+cntr,  }\item[{int}]{irq,  }\item[{unsigned int}]{state }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Linux I\+RQ controller \mbox{\Hypertarget{system_2linux_2irq_8c_ad6bad8e0caf18090c74d135037734500}\label{system_2linux_2irq_8c_ad6bad8e0caf18090c74d135037734500}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!metal\+\_\+linux\+\_\+irq\+\_\+shutdown@{metal\+\_\+linux\+\_\+irq\+\_\+shutdown}}
\index{metal\+\_\+linux\+\_\+irq\+\_\+shutdown@{metal\+\_\+linux\+\_\+irq\+\_\+shutdown}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+linux\+\_\+irq\+\_\+shutdown()}{metal\_linux\_irq\_shutdown()}}
{\footnotesize\ttfamily void metal\+\_\+linux\+\_\+irq\+\_\+shutdown (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



irq handling shutdown 



\subsection{Variable Documentation}
\mbox{\Hypertarget{system_2linux_2irq_8c_a29becacd515e4e3ae71e2397ee2e5ae8}\label{system_2linux_2irq_8c_a29becacd515e4e3ae71e2397ee2e5ae8}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!irq\+\_\+handling\+\_\+stop@{irq\+\_\+handling\+\_\+stop}}
\index{irq\+\_\+handling\+\_\+stop@{irq\+\_\+handling\+\_\+stop}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{irq\+\_\+handling\+\_\+stop}{irq\_handling\_stop}}
{\footnotesize\ttfamily bool irq\+\_\+handling\+\_\+stop\hspace{0.3cm}{\ttfamily [static]}}

stop interrupts handling \mbox{\Hypertarget{system_2linux_2irq_8c_a3d8ff4a6ac19d021cfacbe49c9e84638}\label{system_2linux_2irq_8c_a3d8ff4a6ac19d021cfacbe49c9e84638}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!irq\+\_\+lock@{irq\+\_\+lock}}
\index{irq\+\_\+lock@{irq\+\_\+lock}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{irq\+\_\+lock}{irq\_lock}}
{\footnotesize\ttfamily \hyperlink{structmetal__mutex__t}{metal\+\_\+mutex\+\_\+t} irq\+\_\+lock\hspace{0.3cm}{\ttfamily [static]}}

irq handling lock \mbox{\Hypertarget{system_2linux_2irq_8c_a89821fe6b579aed2ce111200cb872741}\label{system_2linux_2irq_8c_a89821fe6b579aed2ce111200cb872741}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!irq\+\_\+notify\+\_\+fd@{irq\+\_\+notify\+\_\+fd}}
\index{irq\+\_\+notify\+\_\+fd@{irq\+\_\+notify\+\_\+fd}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{irq\+\_\+notify\+\_\+fd}{irq\_notify\_fd}}
{\footnotesize\ttfamily int irq\+\_\+notify\+\_\+fd\hspace{0.3cm}{\ttfamily [static]}}

irq handling state change notification file descriptor \mbox{\Hypertarget{system_2linux_2irq_8c_a0cb68880a956c332edc5d7db941c40f1}\label{system_2linux_2irq_8c_a0cb68880a956c332edc5d7db941c40f1}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!irq\+\_\+pthread@{irq\+\_\+pthread}}
\index{irq\+\_\+pthread@{irq\+\_\+pthread}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{irq\+\_\+pthread}{irq\_pthread}}
{\footnotesize\ttfamily pthread\+\_\+t irq\+\_\+pthread\hspace{0.3cm}{\ttfamily [static]}}

irq handling thread id Indicate which I\+RQ is enabled \mbox{\Hypertarget{system_2linux_2irq_8c_a593c726328bb9676820ce17af79d095b}\label{system_2linux_2irq_8c_a593c726328bb9676820ce17af79d095b}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!irqs@{irqs}}
\index{irqs@{irqs}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{irqs}{irqs}}
{\footnotesize\ttfamily struct \hyperlink{structmetal__irq}{metal\+\_\+irq} irqs\mbox{[}\hyperlink{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}{M\+A\+X\+\_\+\+I\+R\+QS}\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}

Linux I\+R\+Qs array \mbox{\Hypertarget{system_2linux_2irq_8c_a93e518beb51d999eb70289c87dee2cff}\label{system_2linux_2irq_8c_a93e518beb51d999eb70289c87dee2cff}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!irqs\+\_\+devs@{irqs\+\_\+devs}}
\index{irqs\+\_\+devs@{irqs\+\_\+devs}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{irqs\+\_\+devs}{irqs\_devs}}
{\footnotesize\ttfamily struct \hyperlink{structmetal__device}{metal\+\_\+device}$\ast$ irqs\+\_\+devs\mbox{[}\hyperlink{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}{M\+A\+X\+\_\+\+I\+R\+QS}\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}

Linux devices for I\+R\+Qs \mbox{\Hypertarget{system_2linux_2irq_8c_a0663568d605d4d92a0a4e2cd7ac27679}\label{system_2linux_2irq_8c_a0663568d605d4d92a0a4e2cd7ac27679}} 
\index{system/linux/irq.\+c@{system/linux/irq.\+c}!irqs\+\_\+enabled@{irqs\+\_\+enabled}}
\index{irqs\+\_\+enabled@{irqs\+\_\+enabled}!system/linux/irq.\+c@{system/linux/irq.\+c}}
\subsubsection{\texorpdfstring{irqs\+\_\+enabled}{irqs\_enabled}}
{\footnotesize\ttfamily unsigned long irqs\+\_\+enabled\mbox{[}\hyperlink{group__utilities_gace231318276c47f6e2fbc12e61fd5b7c}{metal\+\_\+div\+\_\+round\+\_\+up}(\hyperlink{system_2linux_2irq_8c_a10eb780a1787dc53def561b43152cea4}{M\+A\+X\+\_\+\+I\+R\+QS}, \hyperlink{group__utilities_ga346994d9555206ff5b417774f1b1a81c}{M\+E\+T\+A\+L\+\_\+\+B\+I\+T\+S\+\_\+\+P\+E\+R\+\_\+\+U\+L\+O\+NG})\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}

