\hypertarget{utilities_8c}{}\section{lib/system/linux/utilities.c File Reference}
\label{utilities_8c}\index{lib/system/linux/utilities.\+c@{lib/system/linux/utilities.\+c}}
{\ttfamily \#include $<$metal/utilities.\+h$>$}\newline
{\ttfamily \#include $<$metal/sys.\+h$>$}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{utilities_8c_ab5b577a1de0170d6cce377904348be3d}{metal\+\_\+open} (const char $\ast$path, int shm)
\begin{DoxyCompactList}\small\item\em Open (or create) a file. \end{DoxyCompactList}\item 
int \hyperlink{utilities_8c_a723827c37573080e66a86209c7b0bf2c}{metal\+\_\+open\+\_\+unlinked} (const char $\ast$path, int shm)
\begin{DoxyCompactList}\small\item\em Open (or create) and unlink a file. \end{DoxyCompactList}\item 
void \hyperlink{utilities_8c_a88c932c95a9fe327c5c6fc02cad3fe08}{metal\+\_\+randomize\+\_\+string} (char $\ast$template)
\begin{DoxyCompactList}\small\item\em Randomize a string. \end{DoxyCompactList}\item 
void \hyperlink{utilities_8c_aa5b28b14fb7cc347422b6527afe111ee}{metal\+\_\+mktemp\+\_\+template} (char template\mbox{[}P\+A\+T\+H\+\_\+\+M\+AX\mbox{]}, const char $\ast$name)
\begin{DoxyCompactList}\small\item\em Create a file name template suitable for use with metal\+\_\+mktemp. \end{DoxyCompactList}\item 
int \hyperlink{utilities_8c_a10a528d711cec83156b4214f539185e7}{metal\+\_\+mktemp} (char $\ast$template, int fifo)
\begin{DoxyCompactList}\small\item\em Create a temporary file or fifo. \end{DoxyCompactList}\item 
int \hyperlink{utilities_8c_ad4a43dffbce090ecd91567d1408adef0}{metal\+\_\+mktemp\+\_\+unlinked} (char $\ast$template)
\begin{DoxyCompactList}\small\item\em Open (or create) and unlink a temporary file. \end{DoxyCompactList}\item 
int \hyperlink{utilities_8c_a43bbfacb4d10554ba3c1c0c5c215287b}{metal\+\_\+map} (int fd, off\+\_\+t offset, size\+\_\+t size, int expand, int flags, void $\ast$$\ast$result)
\begin{DoxyCompactList}\small\item\em Map a segment of a file/device. \end{DoxyCompactList}\item 
int \hyperlink{utilities_8c_abbf9bf7dda86eaa3899df6545eda4770}{metal\+\_\+unmap} (void $\ast$mem, size\+\_\+t size)
\begin{DoxyCompactList}\small\item\em Unmap a segment of the process address space. \end{DoxyCompactList}\item 
int \hyperlink{utilities_8c_a82659bceed0a4236dec535a0fa792f8d}{metal\+\_\+mlock} (void $\ast$mem, size\+\_\+t size)
\begin{DoxyCompactList}\small\item\em Lock in a region of the process address space. \end{DoxyCompactList}\item 
int \hyperlink{utilities_8c_a9502bc6c550bfc4f4428d1912c943e69}{metal\+\_\+virt2phys} (void $\ast$addr, unsigned long $\ast$phys)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{utilities_8c_a43bbfacb4d10554ba3c1c0c5c215287b}\label{utilities_8c_a43bbfacb4d10554ba3c1c0c5c215287b}} 
\index{utilities.\+c@{utilities.\+c}!metal\+\_\+map@{metal\+\_\+map}}
\index{metal\+\_\+map@{metal\+\_\+map}!utilities.\+c@{utilities.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+map()}{metal\_map()}}
{\footnotesize\ttfamily int metal\+\_\+map (\begin{DoxyParamCaption}\item[{int}]{fd,  }\item[{off\+\_\+t}]{offset,  }\item[{size\+\_\+t}]{size,  }\item[{int}]{expand,  }\item[{int}]{flags,  }\item[{void $\ast$$\ast$}]{result }\end{DoxyParamCaption})}



Map a segment of a file/device. 

This function maps a segment of a file or device into the process address space, after optionally expanding the file if necessary. If required, the file is expanded to hold the requested map area. This is done under and advisory lock, and therefore the called must not have an advisory lock on the file being mmapped.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em fd} & File descriptor to map. \\
\hline
\mbox{\tt in}  & {\em offset} & Offset in file to map. \\
\hline
\mbox{\tt in}  & {\em size} & Size of region to map. \\
\hline
\mbox{\tt in}  & {\em expand} & Allow file expansion via ftruncate if non-\/zero. \\
\hline
\mbox{\tt in}  & {\em flags} & Flags for mmap(), M\+A\+P\+\_\+\+S\+H\+A\+R\+ED included implicitly. \\
\hline
\mbox{\tt out}  & {\em result} & Returned pointer to new memory map. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, or -\/errno on error. 
\end{DoxyReturn}
\mbox{\Hypertarget{utilities_8c_a10a528d711cec83156b4214f539185e7}\label{utilities_8c_a10a528d711cec83156b4214f539185e7}} 
\index{utilities.\+c@{utilities.\+c}!metal\+\_\+mktemp@{metal\+\_\+mktemp}}
\index{metal\+\_\+mktemp@{metal\+\_\+mktemp}!utilities.\+c@{utilities.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+mktemp()}{metal\_mktemp()}}
{\footnotesize\ttfamily int metal\+\_\+mktemp (\begin{DoxyParamCaption}\item[{char $\ast$}]{template,  }\item[{int}]{fifo }\end{DoxyParamCaption})}



Create a temporary file or fifo. 

This function creates a temporary file or fifo, and sets the O\+\_\+\+C\+L\+O\+E\+X\+EC flag on it.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em template} & File name template (the last 6 characters must be X\+X\+X\+X\+XX per mkstemp requirements). \\
\hline
\mbox{\tt in}  & {\em fifo} & Non-\/zero to create a F\+I\+FO instead of a regular file. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
File descriptor. 
\end{DoxyReturn}
\mbox{\Hypertarget{utilities_8c_aa5b28b14fb7cc347422b6527afe111ee}\label{utilities_8c_aa5b28b14fb7cc347422b6527afe111ee}} 
\index{utilities.\+c@{utilities.\+c}!metal\+\_\+mktemp\+\_\+template@{metal\+\_\+mktemp\+\_\+template}}
\index{metal\+\_\+mktemp\+\_\+template@{metal\+\_\+mktemp\+\_\+template}!utilities.\+c@{utilities.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+mktemp\+\_\+template()}{metal\_mktemp\_template()}}
{\footnotesize\ttfamily void metal\+\_\+mktemp\+\_\+template (\begin{DoxyParamCaption}\item[{char}]{template\mbox{[}\+P\+A\+T\+H\+\_\+\+M\+A\+X\mbox{]},  }\item[{const char $\ast$}]{name }\end{DoxyParamCaption})}



Create a file name template suitable for use with metal\+\_\+mktemp. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt out}  & {\em template} & Template string to be filled in. \\
\hline
\mbox{\tt in}  & {\em name} & Module/user identifier used as part of the generated template. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{utilities_8c_ad4a43dffbce090ecd91567d1408adef0}\label{utilities_8c_ad4a43dffbce090ecd91567d1408adef0}} 
\index{utilities.\+c@{utilities.\+c}!metal\+\_\+mktemp\+\_\+unlinked@{metal\+\_\+mktemp\+\_\+unlinked}}
\index{metal\+\_\+mktemp\+\_\+unlinked@{metal\+\_\+mktemp\+\_\+unlinked}!utilities.\+c@{utilities.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+mktemp\+\_\+unlinked()}{metal\_mktemp\_unlinked()}}
{\footnotesize\ttfamily int metal\+\_\+mktemp\+\_\+unlinked (\begin{DoxyParamCaption}\item[{char $\ast$}]{template }\end{DoxyParamCaption})}



Open (or create) and unlink a temporary file. 

This function creates a temporary file, and sets the O\+\_\+\+C\+L\+O\+E\+X\+EC flag on it. O\+\_\+\+C\+L\+O\+E\+X\+EC flag set. This file is then unlinked to ensure that it is removed when the last reference to the file is dropped. This ensures that libmetal shared maps are released appropriately once all users of the shared data exit.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em template} & File name template (the last 6 characters must be X\+X\+X\+X\+XX per mkstemp requirements). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
File descriptor. 
\end{DoxyReturn}
\mbox{\Hypertarget{utilities_8c_a82659bceed0a4236dec535a0fa792f8d}\label{utilities_8c_a82659bceed0a4236dec535a0fa792f8d}} 
\index{utilities.\+c@{utilities.\+c}!metal\+\_\+mlock@{metal\+\_\+mlock}}
\index{metal\+\_\+mlock@{metal\+\_\+mlock}!utilities.\+c@{utilities.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+mlock()}{metal\_mlock()}}
{\footnotesize\ttfamily int metal\+\_\+mlock (\begin{DoxyParamCaption}\item[{void $\ast$}]{mem,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Lock in a region of the process address space. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mem} & Pointer to start of region. \\
\hline
\mbox{\tt in}  & {\em size} & Size of region. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, or -\/errno on error. 
\end{DoxyReturn}
\mbox{\Hypertarget{utilities_8c_ab5b577a1de0170d6cce377904348be3d}\label{utilities_8c_ab5b577a1de0170d6cce377904348be3d}} 
\index{utilities.\+c@{utilities.\+c}!metal\+\_\+open@{metal\+\_\+open}}
\index{metal\+\_\+open@{metal\+\_\+open}!utilities.\+c@{utilities.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+open()}{metal\_open()}}
{\footnotesize\ttfamily int metal\+\_\+open (\begin{DoxyParamCaption}\item[{const char $\ast$}]{path,  }\item[{int}]{shm }\end{DoxyParamCaption})}



Open (or create) a file. 

This function opens or creates a file with read/write permissions and the O\+\_\+\+C\+L\+O\+E\+X\+EC flag set.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em path} & File path to open. \\
\hline
\mbox{\tt in}  & {\em shm} & Open shared memory (via shm\+\_\+open) if non-\/zero. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
File descriptor. 
\end{DoxyReturn}
\mbox{\Hypertarget{utilities_8c_a723827c37573080e66a86209c7b0bf2c}\label{utilities_8c_a723827c37573080e66a86209c7b0bf2c}} 
\index{utilities.\+c@{utilities.\+c}!metal\+\_\+open\+\_\+unlinked@{metal\+\_\+open\+\_\+unlinked}}
\index{metal\+\_\+open\+\_\+unlinked@{metal\+\_\+open\+\_\+unlinked}!utilities.\+c@{utilities.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+open\+\_\+unlinked()}{metal\_open\_unlinked()}}
{\footnotesize\ttfamily int metal\+\_\+open\+\_\+unlinked (\begin{DoxyParamCaption}\item[{const char $\ast$}]{path,  }\item[{int}]{shm }\end{DoxyParamCaption})}



Open (or create) and unlink a file. 

This function opens or creates a file with read/write permissions and the O\+\_\+\+C\+L\+O\+E\+X\+EC flag set. This file is then unlinked to ensure that it is removed when the last reference to the file is dropped. This ensures that libmetal shared maps are released appropriately once all users of the shared data exit.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em path} & File path to open. \\
\hline
\mbox{\tt in}  & {\em shm} & Open shared memory (via shm\+\_\+open) if non-\/zero. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
File descriptor. 
\end{DoxyReturn}
\mbox{\Hypertarget{utilities_8c_a88c932c95a9fe327c5c6fc02cad3fe08}\label{utilities_8c_a88c932c95a9fe327c5c6fc02cad3fe08}} 
\index{utilities.\+c@{utilities.\+c}!metal\+\_\+randomize\+\_\+string@{metal\+\_\+randomize\+\_\+string}}
\index{metal\+\_\+randomize\+\_\+string@{metal\+\_\+randomize\+\_\+string}!utilities.\+c@{utilities.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+randomize\+\_\+string()}{metal\_randomize\_string()}}
{\footnotesize\ttfamily void metal\+\_\+randomize\+\_\+string (\begin{DoxyParamCaption}\item[{char $\ast$}]{template }\end{DoxyParamCaption})}



Randomize a string. 

This function randomizes the contents of a string.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em template} & String to be randomized. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{utilities_8c_abbf9bf7dda86eaa3899df6545eda4770}\label{utilities_8c_abbf9bf7dda86eaa3899df6545eda4770}} 
\index{utilities.\+c@{utilities.\+c}!metal\+\_\+unmap@{metal\+\_\+unmap}}
\index{metal\+\_\+unmap@{metal\+\_\+unmap}!utilities.\+c@{utilities.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+unmap()}{metal\_unmap()}}
{\footnotesize\ttfamily int metal\+\_\+unmap (\begin{DoxyParamCaption}\item[{void $\ast$}]{mem,  }\item[{size\+\_\+t}]{size }\end{DoxyParamCaption})}



Unmap a segment of the process address space. 

This function unmaps a segment of the process address space.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mem} & Segment to unmap. \\
\hline
\mbox{\tt in}  & {\em size} & Size of region to unmap. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, or -\/errno on error. 
\end{DoxyReturn}
\mbox{\Hypertarget{utilities_8c_a9502bc6c550bfc4f4428d1912c943e69}\label{utilities_8c_a9502bc6c550bfc4f4428d1912c943e69}} 
\index{utilities.\+c@{utilities.\+c}!metal\+\_\+virt2phys@{metal\+\_\+virt2phys}}
\index{metal\+\_\+virt2phys@{metal\+\_\+virt2phys}!utilities.\+c@{utilities.\+c}}
\subsubsection{\texorpdfstring{metal\+\_\+virt2phys()}{metal\_virt2phys()}}
{\footnotesize\ttfamily int metal\+\_\+virt2phys (\begin{DoxyParamCaption}\item[{void $\ast$}]{addr,  }\item[{unsigned long $\ast$}]{phys }\end{DoxyParamCaption})}

